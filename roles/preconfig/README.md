# Роль preconfig

[![Ansible](https://img.shields.io/badge/Ansible-EE0000?style=for-the-badge&logo=ansible&logoColor=white)](https://www.ansible.com) [![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://www.docker.com) [![NGINX](https://img.shields.io/badge/NGINX-009639?style=for-the-badge&logo=nginx&logoColor=white)](https://www.nginx.com) [![PHP](https://img.shields.io/badge/PHP-777BB4?style=for-the-badge&logo=php&logoColor=white)](https://www.php.net)

<!-- TOC tocDepth:2..3 chapterDepth:2..6 -->

- [Роль preconfig](#роль-preconfig)
  - [Описание](#описание)
  - [Поддерживаемые платформы](#поддерживаемые-платформы)
  - [Требования](#требования)
  - [Переменные роли](#переменные-роли)
  - [Зависимости](#зависимости)
  - [Структура файлов](#структура-файлов)
  - [Основные задачи](#основные-задачи)
  - [Порты](#порты)
  - [Особенности](#особенности)

<!-- /TOC -->

## Описание

Роль `preconfig` выполняет первоначальную настройку сервера для работы с Docker, Nginx и PHP. Она автоматизирует установку необходимых пакетов, настройку окружения и подготовку системы к развертыванию веб-приложений.

## Поддерживаемые платформы

* Linux (тестировалось на Ubuntu Server 24)

## Требования

* Ansible версии 2.9 или выше
* Docker и Docker Compose, установленные на целевом сервере
* Пользователь с правами на выполнение Docker-команд

## Переменные роли

Нет настраиваемых переменных (все параметры задаются непосредственно в задачах)

## Зависимости

Не зависит от других ролей

## Структура файлов

```text
preconfig/
├── handlers/                   # Обработчики
│   └── role_preconfig.yml
├── meta/                       # Метаданные роли
│   └── main.yml
└── tasks/                      # Основные задачи роли
    └── main.yml
```

## Основные задачи

* Создает домашнюю директорию проекта (`/home/user/php_app`)
* Устанавливает Nginx, PHP и необходимые модули
* Устанавливает Docker и сопутствующие пакеты
* Настраивает Docker для работы без sudo
* Проверяет и запускает службу Docker

## Порты

Нет прямого управления портами (роль только подготавливает окружение)

## Особенности
* После выполнения роли может потребоваться перезапуск SSH-сессии для применения изменений прав
* Роль предназначена для использования перед развертыванием `docker_compose`
* Все изменения выполняются от имени пользователя, указанного в `ansible_user`
* Полная автоматизация установки всех зависимостей для работы с Docker и PHP
* Безопасность: пользователь добавляется в группу `docker` для работы `без sudo`
* Гибкость: может использоваться как самостоятельная роль или как зависимость
* Уведомления: информирует о необходимости перезагрузки сессии после добавления в группу `docker`
* Поддержка последних версий: использует официальные репозитории Docker