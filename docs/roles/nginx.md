# Роль Nginx


## Описание
Эта роль предназначена для настройки и обслуживания веб-сервера Nginx в контейнере Docker. Она управляет конфигурацией Nginx и обеспечивает интеграцию с PHP-FPM, а также настроенными сетевыми параметрами. Роль создана для упрощения процесса развертывания веб-приложений.


## Структура файлов роли
```text
roles/nginx/
├── defaults
│   └── main.yml              # Переменные по умолчанию
├── handlers
│   └── main.yaml             # Обработчики для перезапуска Nginx
├── tasks
│   └── main.yaml             # Основные задачи роли
└── templates
    └── nginx.conf.j2         # Шаблон конфигурации Nginx
```

## Переменные по умолчанию
По умолчанию используются следующие переменные, определённые в файле `defaults/main.yml`:  
- `nginx_user`: Пользователь, под которым работает Nginx, по умолчанию установлен как `nginx`  
- `nginx_worker_processes`: Количество процессов-воркеров, по умолчанию задано как `auto`  
- `nginx_error_log`: Путь к файлу журнала ошибок Nginx  
- `nginx_error_log_level`: Уровень ведения журнала ошибок, по умолчанию `notice`  
- `nginx_pid_file`: Путь к файлу с PID процесса Nginx, по умолчанию `/var/run/nginx.pid`  
- `nginx_worker_connections`: Максимальное количество подключений для каждого процесса-воркера, по умолчанию 1024  
- `nginx_log_format`: Формат журналирования  
- `nginx_access_log`: Путь к файлу журнала доступа, по умолчанию `/var/log/nginx/access.log`  
- `nginx_keepalive_timeout`: Время ожидания для соединений, по умолчанию 65  
- `nginx_listen_port`: Порт для прослушивания, по умолчанию 80  
- `nginx_server_name`: Имя сервера, по умолчанию `localhost`  
- `nginx_index_files`: Список файлов индекса, по умолчанию `index.php index.html index.htm`  
- `nginx_document_root`: Корневая директория для обслуживания файлов  
- `nginx_php_socket`: Сокет для подключения к PHP-FPM, по умолчанию `web:9000`  


## Порядок выполнения
1. Роль копирует конфигурацию Nginx из шаблона `nginx.conf.j2` на удалённый сервер  
2. После копирования конфигурации вызывается обработчик для перезапуска Nginx, чтобы применить изменения  


## Шаблон конфигурации
Шаблон конфигурации `templates/nginx.conf.j2` содержит все необходимые настройки, включая обработку PHP файлов и поддержку статических файлов.


## Заключение
Эта роль позволяет быстро и эффективно настраивать Nginx для работы с веб-приложениями в контейнеризованном окружении. Благодаря использованию шаблонов, вы можете легко адаптировать конфигурацию под ваши нужды, сохраняя при этом простоту управления.